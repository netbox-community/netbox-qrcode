
# Doeses Docker Compose Debug File supports you with debugging in VSCode

# Recommended VSCode Extensions (I think):
# - Docker (Extension ID: ms-azuretools.vscode-docker)
# - Python (Extension ID: ms-python.python)
# - Python Debugger (Extension ID: ms-python.debugpy)

# - Start Docker-Compose with Docker-Compose-Debug bout the vsCode terminal and enter the following line:
#   docker-compose -f develop/docker-compose.yml -f develop/docker-compose-debug.yml up --build
# - Wait until all containers are started and Starting development server at http://0.0.0.0:8000/ is displayed.

# - Go to "Run and Debug" and start the debug "Docker: Python -Django" (The footer of vsCode should become Orang.)
# - Set a breakpoint in the code 
# - Open the NetBox page with the plugin.

# Helpful documentary:
# https://medium.com/django-unleashed/debug-django-application-in-docker-container-using-vscode-ca5967340262
# https://testdriven.io/blog/django-debugging-vs-code/
# https://github.com/microsoft/debugpy
# https://docs.python.org/3/using/cmdline.html#cmdoption-X

# Overwrites parts of the service from the Docker-Compose file:
---
services:
  netbox:

    # The following commands are executed
    # - Install Current Version of DebugPy for Debug in Visual Studio Code https://github.com/microsoft/debugpy
    # - PYDEVD_DISABLE_FILE_VALIDATION=1 --> Youâ€™re telling the debugger to skip this validation and proceed with debugging
    # - Migrate Netbox
    # - Start Netbox with Modul DebugPy (Xfrozen_modules=off --> Disable Frozen Moduls in DebugPy Mode; 5678 is Debug Port)
    command: >
        sh -c "echo Run Netbox Django in debug mode &&
               pip install debugpy &&
               PYDEVD_DISABLE_FILE_VALIDATION=1 &&
               python manage.py migrate && 
               python -Xfrozen_modules=off -m debugpy --listen 0.0.0.0:5678 manage.py runserver 0.0.0.0:8000 --insecure"
    ports:
      - '8000:8000'
      - '5678:5678'
  worker:
    # Enables the synchronization of source code files with the Docker container during debugging.
    # Without this option, changed files in the Docker container are only transferred to VSCode.
    # Currently HTML files are changed live. After saving a *.py file, the container is automatically rebuilt. I don't know if this can be optimized. Greetings LHBL2003.
    # https://www.docker.com/blog/docker-compose-experiment-sync-files-and-automatically-rebuild-services-with-watch-mode/
    x-develop:
      watch:
        - action: sync
          path: ../netbox_qrcode
          target: /source/netbox_qrcode
        #- action: rebuild
          #path: package.json